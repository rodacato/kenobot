#!/usr/bin/env bash

# Backup KenoBot data directory
# Usage: bin/backup
# Env: BACKUP_DIR (default: $HOME/.kenobot-backups)

set -e

cd "$(dirname "$0")/.."

BACKUP_DIR="${BACKUP_DIR:-$HOME/.kenobot-backups}"
TIMESTAMP=$(date +%Y%m%d-%H%M%S)

if [ ! -d "data" ]; then
  echo "No data/ directory found, nothing to backup"
  exit 0
fi

mkdir -p "$BACKUP_DIR"
tar -czf "$BACKUP_DIR/kenobot-$TIMESTAMP.tar.gz" data/

# Rotate: keep only the last 30 backups
ls -t "$BACKUP_DIR"/kenobot-*.tar.gz 2>/dev/null | tail -n +31 | xargs rm -f 2>/dev/null || true

echo "Backup created: $BACKUP_DIR/kenobot-$TIMESTAMP.tar.gz"
